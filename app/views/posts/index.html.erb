
<%= link_to 'New Post', new_post_path if user_signed_in? %>

<div id="posts">

  <% @posts.each do |post| %>
    
    <div class="post <%= cycle('light', 'dark') %>">

      <div class="post-text">
        <h3><%= post.title%></h3>
        
        <p><span class="upvotes"><%= post.votes.where(:upvote => true).count %> UpVotes </span><br> <span class="downvotes"><%= post.votes.where(:downvote => true).count %> DownVotes</span></p>

        <p><em>Posted by:</em> <%= post.user.email %><em> at: </em><%= post.created_at%></p>

        <p><%= image_tag post.image, :width => '150px' %></p>
        <p><%= markdown post.content.truncate(350) %><%= link_to 'Read More', post %></p> <!-- truncate this  -->
      
      </div> <!-- end post text  -->

      <% if user_signed_in? %>

      <% vote = current_user.votes.new(:post_id => post.id) %>
        
        <%= form_for([post, vote]) do |f| %>
          <%= f.hidden_field :upvote, :value => true %>
          <%= f.submit 'Vote Up' %>
        <% end %>

        <%= form_for([post, vote]) do |f| %>
          <%= f.hidden_field :downvote, :value => true %>
          <%= f.submit 'Vote Down' %>
        <% end %>


        <%= link_to 'Edit', edit_post_path(post) if user_signed_in? && current_user == post.user %>
        <%= link_to 'Destroy', post, method: :delete, data: { confirm: 'Are you sure?' } if user_signed_in? && current_user == post.user %>

      <% end %>

    </div><!-- end post div -->

  <% end %>

</div> <!-- end posts div -->

